"use strict";var _createClass=function(){function n(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var offlineMessage=document.getElementById("offline"),noDataMessage=document.getElementById("no-data"),dataSavedMessage=document.getElementById("data-saved"),saveErrorMessage=document.getElementById("save-error"),DBHelper=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"getAlternativeText",value:function(e){return{1:"Interior of Mission Chinese Food",2:"Pizza Quattro Formaggi",3:"Interior of Kang Ho Dong Baekjeong",4:"Outside view of Katz's Delicatessen at night",5:"Open kitchen of Roberta's Pizza",6:"People queueing at Hometown BBQ",7:"Outside view of Superiority Burger",8:"Outside view of The Dutch",9:"People eating at Mu Ramen",10:"Interior of Casa Enrique"}[e]}},{key:"messageOffline",value:function(){var e=this.getLastUpdated();e&&(offlineMessage.textContent+=" Last fetched server data: "+e),offlineMessage.style.display="block"}},{key:"messageNoData",value:function(){noDataMessage.style.display="block"}},{key:"messageDataSaved",value:function(){var e=this.getLastUpdated();e&&(dataSavedMessage.textContent+=" on "+e),dataSavedMessage.style.display="block"}},{key:"messageSaveError",value:function(){saveErrorMessage.style.display="block"}},{key:"getLastUpdated",value:function(){return localStorage.getItem("lastUpdated")}},{key:"setLastUpdated",value:function(e){localStorage.setItem("lastUpdated",e)}},{key:"logResult",value:function(e){console.log(e)}},{key:"logError",value:function(e){console.log("[ERROR] Looks like there was a problem: \n",e)}},{key:"validateResponse",value:function(e){if(!e.ok)throw Error(e.statusText);return e}},{key:"readResponseAsJSON",value:function(e){return e.json()}},{key:"getServerData",value:function(e){return fetch(e).then(this.validateResponse).then(this.readResponseAsJSON)}},{key:"getRestaurantURL",value:function(e){return"restaurant.html?id="+e.id}},{key:"getImageUrlForRestaurant",value:function(e,t,a){var n="jpg";switch(t){case"jpeg":break;case"webp":n="webp";break;default:console.log("[DEBUG] unhandled imageType: "+t)}return void 0!==a?"img/"+e.id+"_w_"+a+"."+n:"img/"+e.id+"_w_800."+n}},{key:"addMarkerForRestaurant",value:function(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:a.getRestaurantURL(e),map:t,animation:google.maps.Animation.DROP})}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337"}}]),a}(),map=void 0,restaurant=void 0,elementBreadcrumb=document.getElementById("breadcrumb"),elementCardPrimary=document.getElementById("card-primary"),elementRestaurantName=document.getElementById("restaurant-name"),elementRestaurantAddress=document.getElementById("restaurant-address"),elementRestaurantCuisine=document.getElementById("restaurant-cuisine"),elementRestaurantHours=document.getElementById("restaurant-hours"),elementGoogleMap=document.getElementById("map"),elementReviewsContainer=document.getElementById("reviews-container"),elementReviewsList=document.getElementById("reviews-list");window.initMap=function(){var e=getParameterByName("id");loadRestaurantNetworkFirst(e)};var loadRestaurantNetworkFirst=function(t){var e="http://localhost:1337/restaurants/"+t;DBHelper.getServerData(e).then(function(e){self.restaurant=e,updateRestaurantUI(),createBreadcrumb(),saveRestaurantsDataLocally(e).then(function(){DBHelper.setLastUpdated(new Date)}).catch(function(e){console.warn(e)}),createGoogleMaps()}).catch(function(e){console.log("[DEBUG] Network requests have failed, this is expected if offline"),getLocalRestaurantByIdData(t).then(function(e){self.restaurant=e,updateRestaurantUI(),createBreadcrumb(),createGoogleMaps()}).catch(function(e){console.warn(e)})})},createGoogleMaps=function(){map=new google.maps.Map(elementGoogleMap,{center:{lat:40.722216,lng:-73.987501},zoom:12}),DBHelper.addMarkerForRestaurant(self.restaurant,self.map);map.addListener("tilesloaded",function(){document.querySelector("#map iframe").setAttribute("title","Google Maps overview of restaurants")})},updateRestaurantUI=function(){var e=createResponsivePicture(self.restaurant);elementCardPrimary.parentNode.insertBefore(e,elementCardPrimary),elementRestaurantName.innerHTML=self.restaurant.name,elementRestaurantName.tabIndex="0",elementRestaurantAddress.innerHTML=self.restaurant.address,elementRestaurantCuisine.innerHTML=self.restaurant.cuisine_type,restaurant.operating_hours&&updateRestaurantHoursUI(),updateReviewsUI()},updateRestaurantHoursUI=function(){var e=self.restaurant.operating_hours;for(var t in e){var a=document.createElement("tr");a.className="restaurant-card-table-content",a.tabIndex="0";var n=document.createElement("td");n.innerHTML=t,a.appendChild(n);var r=document.createElement("td");r.innerHTML=e[t],a.appendChild(r),elementRestaurantHours.appendChild(a)}},updateReviewsUI=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.reviews,t=document.createElement("h3");if(t.className="reviews-title",t.innerHTML="Reviews",elementReviewsContainer.appendChild(t),!e){var a=document.createElement("p");return a.innerHTML="No reviews yet!",void elementReviewsContainer.appendChild(a)}e.forEach(function(e){elementReviewsList.appendChild(createReviewHTML(e))}),elementReviewsContainer.appendChild(elementReviewsList)},createReviewHTML=function(e){var t=document.createElement("li");t.className="review-card";var a=document.createElement("div");a.className="card-primary";var n=document.createElement("h2");n.className="card-title",n.innerHTML=e.name,a.appendChild(n);var r=document.createElement("h3");r.className="card-subtitle",r.innerHTML=e.date,a.appendChild(r),t.appendChild(a);var s=document.createElement("div");s.className="review-card-rating";var o=document.createElement("p");o.className="review-card-rating-content",o.innerHTML="Rating: "+e.rating,s.append(o),t.appendChild(s);var l=document.createElement("div");l.className="card-secondary";var i=document.createElement("p");return i.className="card-secondary-content",i.innerHTML=e.comments,l.appendChild(i),t.appendChild(l),t},createBreadcrumb=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=document.createElement("li");t.className="breadcrumb",t.innerHTML=e.name,t.setAttribute("aria-current","page"),elementBreadcrumb.appendChild(t)},getParameterByName=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var a=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null},createResponsivePicture=function(e){var t=document.createElement("picture"),a="(max-width: 37.4375rem) 100vw, (min-width: 37.5rem) 50vw, 100vw",n=DBHelper.getImageUrlForRestaurant(e,"webp",300)+" 300w,\n    "+DBHelper.getImageUrlForRestaurant(e,"webp",433)+" 433w,\n    "+DBHelper.getImageUrlForRestaurant(e,"webp",552)+" 552w,\n    "+DBHelper.getImageUrlForRestaurant(e,"webp",653)+" 653w,\n    "+DBHelper.getImageUrlForRestaurant(e,"webp",752)+" 752w,\n    "+DBHelper.getImageUrlForRestaurant(e,"webp",800)+" 800w",r=DBHelper.getImageUrlForRestaurant(e,"jpeg",300)+" 300w,\n    "+DBHelper.getImageUrlForRestaurant(e,"jpeg",433)+" 433w,\n    "+DBHelper.getImageUrlForRestaurant(e,"jpeg",552)+" 552w,\n    "+DBHelper.getImageUrlForRestaurant(e,"jpeg",653)+" 653w,\n    "+DBHelper.getImageUrlForRestaurant(e,"jpeg",752)+" 752w,\n    "+DBHelper.getImageUrlForRestaurant(e,"jpeg",800)+" 800w",s=document.createElement("source");s.srcset=n,s.sizes=a,s.type="image/webp",t.appendChild(s);var o=document.createElement("source");o.srcset=r,o.sizes=a,o.type="image/jpeg",t.appendChild(o);var l=document.createElement("img"),i=DBHelper.getImageUrlForRestaurant(e,"jpeg",800);l.src=i;var u=DBHelper.getAlternativeText(e.id);return u||(u="Restaurant "+e.name),l.alt=u,l.tabIndex="0",t.appendChild(l),t};
//# sourceMappingURL=resto-bundle.min.js.map
